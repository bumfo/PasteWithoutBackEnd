<!doctype html>
<title>Paste without Back End</title>

<section>
  <h1>Paste without Back End</h1>

  <div><textarea id="b" cols="40" style="width: 60%; display: none;"></textarea></div>
  <div><textarea id="c" cols="40" rows="20" style="width: 60%"></textarea></div>
</section>

<script src="bin.js"></script>
<script>
  function basename(str) {
    var base = new String(str).substring(str.lastIndexOf('/') + 1); 
    return base;
  }

  function base64ToUint8(base64) {
    var raw = window.atob(base64);
    var rawLength = raw.length;
    var array = new Uint8Array(new ArrayBuffer(rawLength));

    for(i = 0; i < rawLength; i++) {
      array[i] = raw.charCodeAt(i);
    }
    return array;
  }


  var B = document.querySelector('#b');
  var C = document.querySelector('#c');

  var decode = async () => {
    var b = B.value;

    var c = b
      .replace(/-/g, '+')
      .replace(/_/g, '/');

    var d = base64ToUint8(c);

    var e = await lzma_decompress(d);
    C.value = e;
  };

  B.oninput = decode;

  B.value = basename(location.href);

  (async function() {
    try {
      await decode();
    } catch (e) {
      var div = document.createElement('div');
      div.textContent = 'Invalid URL';
      document.body.replaceChild(div, document.body.firstChild);
    }
  }());

</script>
